<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<style type="text/css">
		body,ul{margin: 0;padding: 0;}
		li{list-style: none;}
		.list{width: 490px;height: 420px;margin: 50px auto; -webkit-perspective: 600px;-webkit-transform-style: preserve-3d;}
		.list li{width: 47px;height: 58px;border:1px solid rgba(0,0,0,0);background: url(1.jpg) no-repeat;float: left;background-origin: border-box;transition: .5s background,.2s border,.3s .2s box-shadow, 2s 0.4s -webkit-transform,2s 0.4s opacity;}
	</style>
	<script type="text/javascript">
		window.onload = function(){
			var oList = document.getElementById('list');
			var aLi = oList.getElementsByTagName('li');
			var aInput = document.getElementsByTagName('input');
			var iRows = oList.offsetHeight/aLi[0].offsetHeight;
			var iCeils = aLi.length/iRows;
			var oXyLi = setXy(aLi,iRows,iCeils);
			console.log(oXyLi);
			aInput[0].onclick =function(){
				tab(oXyLi,iCeils-1,iRows-1,-1,-1,function(){
					with(this.style){
                       borderColor = 'rgba(0,0,0,0.8)';
                       boxShadow ='0 0 6px blue';
                       WebkitTransform = 'translate(-50px,-100px) rotateX(-720deg) rotateY(-540deg)';
                       opacity = 0;
					}
				},50)
			}
			aInput[1].onclick =function(){
				tab(oXyLi,0,0,1,1,function(){
					with(this.style){
                       borderColor = 'rgba(0,0,0,0)';
                       boxShadow ='0 0 0 blue';
                       WebkitTransform = 'translate(0,0) rotateX(0deg) rotateY(0deg)';
                       opacity = 1;
					}
				},50)
			}

		}

		function tab(arr,x,y,iSpeedX,iSpeedY,fn,iDelay){
			if(!arr[y] || !arr[y][x]){
				return;
			}
            if(fn){
            	fn.call(arr[y][x]);
            	clearTimeout(arr[y][x].timer);
            	arr[y][x].timer = setTimeout(function(){
            		tab(arr,x,y+iSpeedY,iSpeedX,iSpeedY,fn,iDelay);
            	    tab(arr,x+iSpeedX,y,iSpeedX,iSpeedY,fn,iDelay);
            	},iDelay);
            	
            }
		}

		function setXy(objs,iRows,iCeils){
			var arr = [];
			for(var i=0;i<iRows;i++){
				var arr2 = [];
				for(var j=0; j<iCeils;j++){
					objs[i*iCeils+j].yIndex = j;
					objs[i*iCeils+j].xIndex = i;
					objs[i*iCeils+j].style.backgroundPosition = -(j*49)+'px -'+(i*60)+'px';
					arr2.push(objs[i*iCeils+j]);
				};
				arr.push(arr2);
			}
			return arr;
		}
	</script>
</head>
<body>
    <input type="button" value="展开"/>
    <input type="button" value="重置"/>
    <div id="wrap">
	   <ul class="list" id="list">
	   	<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
	   </ul>
	   
	</div>
</body>
</html>